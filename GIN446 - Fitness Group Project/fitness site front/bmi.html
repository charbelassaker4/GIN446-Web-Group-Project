<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>DreamFIT — BMI Calculator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <script type="module" src="../../firebase/state_listener.js"></script>
  </head>
  <body>
    <header class="site-header">
      <div class="logo">Dream<span>FIT</span></div>
      <nav class="main-nav">
        <a href="../index.html">Home</a>
        <a href="bmi.html" class="active">BMI</a>
        <a href="bodyfat.html">Body Fat %</a>
        <a href="workout.html">Workouts</a>
        <a href="nutrition.html">Nutrition</a>
        <a href="muscle-composition.html">Muscle Viewer</a>
        <a href="profile.html">Profile</a>
        <button id="logout-btn" class="pill-btn">Logout</button>
        <script type="module" src="../../firebase/signout.js"></script>
      </nav>
    </header>

    <main class="page-narrow">
      <section class="bmi-hero">
        <div class="bmi-hero-title-row">
          <h1>BMI &amp; Body Status</h1>
          <span class="bmi-glow-pill">Quick health snapshot</span>
        </div>
        <div class="bmi-hero-underline"></div>
        <p class="page-intro">
          Use the Body Mass Index (BMI) to get a quick estimate of your weight
          category. This is only a rough indicator — always combine it with
          common sense, body fat %, and other health markers.
        </p>
      </section>

      <section class="card-section bmi-card-animated">
        <form id="bmi-form" class="form-grid">
          <div class="field">
            <label for="bmi-weight">Weight (kg)</label>
            <input type="number" id="bmi-weight" min="20" step="0.1" required />
          </div>
          <div class="field">
            <label for="bmi-height">Height (cm)</label>
            <input
              type="number"
              id="bmi-height"
              min="120"
              step="0.1"
              required
            />
          </div>
          <div class="field">
            <label for="bmi-goal">Goal</label>
            <select id="bmi-goal">
              <option value="maintain">Maintain</option>
              <option value="cut">Cut (lose fat)</option>
              <option value="bulk">Bulk (gain muscle)</option>
            </select>
          </div>
          <button type="submit" class="btn primary full-width">
            Calculate BMI
          </button>
        </form>

        <!-- Animated result block -->
        <div id="bmi-result" class="bmi-result hidden">
          <div class="bmi-meter">
            <div class="bmi-ring">
              <svg viewBox="0 0 160 160">
                <defs>
                  <linearGradient
                    id="bmiGradient"
                    x1="0%"
                    y1="0%"
                    x2="100%"
                    y2="0%"
                  >
                    <stop offset="0%" stop-color="#0ea5e9" />
                    <stop offset="50%" stop-color="#22c55e" />
                    <stop offset="100%" stop-color="#f97316" />
                  </linearGradient>
                </defs>
                <!-- circle path length ≈ 2πr => 2*π*70 ≈ 439 -->
                <circle class="bmi-ring-bg" cx="80" cy="80" r="70" />
                <circle
                  class="bmi-ring-value"
                  id="bmi-ring-value"
                  cx="80"
                  cy="80"
                  r="70"
                />
              </svg>
              <div class="bmi-ring-center">
                <div class="bmi-number">
                  <span id="bmi-number">0.0</span>
                  <span>kg/m²</span>
                </div>
                <div id="bmi-cat-pill-wrapper"></div>
              </div>
            </div>
          </div>

          <div class="bmi-result-text">
            <h2>Your result</h2>
            <p id="bmi-category"></p>
            <p id="bmi-status-line"></p>
            <p id="bmi-tip" class="small-muted"></p>
          </div>
        </div>
      </section>

      <section class="bmi-table card-section">
        <h2>BMI categories</h2>
        <table>
          <thead>
            <tr>
              <th>Category</th>
              <th>BMI range</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Underweight</td>
              <td>&lt; 18.5</td>
            </tr>
            <tr>
              <td>Normal weight</td>
              <td>18.5 – 24.9</td>
            </tr>
            <tr>
              <td>Overweight</td>
              <td>25 – 29.9</td>
            </tr>
            <tr>
              <td>Obesity</td>
              <td>≥ 30</td>
            </tr>
          </tbody>
        </table>
      </section>
    </main>

    <footer class="site-footer">
      <p>DreamFIT BMI tool — for educational use only.</p>
    </footer>

    <!-- Inline BMI logic + animations -->
    <script>
      const form = document.getElementById("bmi-form");
      const resultBlock = document.getElementById("bmi-result");
      const bmiNumberEl = document.getElementById("bmi-number");
      const bmiRingValue = document.getElementById("bmi-ring-value");
      const bmiCatEl = document.getElementById("bmi-category");
      const bmiStatusLine = document.getElementById("bmi-status-line");
      const bmiTipEl = document.getElementById("bmi-tip");
      const catPillWrapper = document.getElementById("bmi-cat-pill-wrapper");

      function getCategory(bmi) {
        if (bmi < 18.5) return "underweight";
        if (bmi < 25) return "normal";
        if (bmi < 30) return "overweight";
        return "obesity";
      }

      function categoryLabel(cat) {
        switch (cat) {
          case "underweight":
            return "Underweight";
          case "normal":
            return "Normal weight";
          case "overweight":
            return "Overweight";
          case "obesity":
            return "Obesity";
          default:
            return "";
        }
      }

      function goalTip(cat, goal) {
        if (goal === "maintain") {
          if (cat === "normal") {
            return "Great! Staying active, sleeping well, and tracking your nutrition will help you maintain this range.";
          }
          if (cat === "underweight") {
            return "Try to slowly increase your calories with nutrient-dense foods and a resistance-training plan.";
          }
          return "Focus on balanced meals, walking more, and progressive training to move slowly toward the normal range.";
        }

        if (goal === "cut") {
          if (cat === "underweight") {
            return "You are already underweight — a cutting phase is not recommended. Talk to a health professional first.";
          }
          if (cat === "normal") {
            return "Even in the normal range, a small cut must be gentle: small calorie deficit, high protein, and weight training.";
          }
          return "Aim for a slow cut: small calorie deficit, more steps, and consistent workouts. Avoid extreme diets.";
        }

        // bulk
        if (cat === "obesity") {
          return "Before a bulk, it is usually safer to reduce body fat a bit. Focus on a moderate cut and strength training.";
        }
        return "Use a small calorie surplus, high protein, and progressive overload to add mostly muscle, not just fat.";
      }

      function animateNumber(el, from, to, duration) {
        const start = performance.now();
        function frame(now) {
          const t = Math.min(1, (now - start) / duration);
          const value = from + (to - from) * t;
          el.textContent = value.toFixed(1);
          if (t < 1) requestAnimationFrame(frame);
        }
        requestAnimationFrame(frame);
      }

      form.addEventListener("submit", (e) => {
        e.preventDefault();
        const weight = parseFloat(document.getElementById("bmi-weight").value);
        const heightCm = parseFloat(
          document.getElementById("bmi-height").value
        );
        const goal = document.getElementById("bmi-goal").value;

        if (!weight || !heightCm) return;

        const heightM = heightCm / 100;
        const bmi = weight / (heightM * heightM);
        const bmiRounded = parseFloat(bmi.toFixed(1));

        const cat = getCategory(bmiRounded);
        const label = categoryLabel(cat);

        // Show block with animation
        resultBlock.classList.remove("hidden");
        requestAnimationFrame(() => {
          resultBlock.classList.add("visible");
        });

        // Animate number
        const currentDisplayed = parseFloat(bmiNumberEl.textContent) || 0;
        animateNumber(bmiNumberEl, currentDisplayed, bmiRounded, 600);

        // Animate ring: map 0–40 BMI -> 0–100% of circle
        const maxBmiForRing = 40;
        const clamped = Math.max(0, Math.min(maxBmiForRing, bmiRounded));
        const percent = clamped / maxBmiForRing;
        const circumference = 440; // our dasharray
        const offset = circumference * (1 - percent);
        requestAnimationFrame(() => {
          bmiRingValue.style.strokeDashoffset = offset;
        });

        // Texts
        bmiCatEl.textContent = `Category: ${label}`;
        bmiStatusLine.textContent = `Your BMI is ${bmiRounded} kg/m².`;

        // Pill
        catPillWrapper.innerHTML = "";
        const pill = document.createElement("span");
        pill.className =
          "bmi-category-pill " +
          (cat === "underweight"
            ? "bmi-category-underweight"
            : cat === "normal"
            ? "bmi-category-normal"
            : cat === "overweight"
            ? "bmi-category-overweight"
            : "bmi-category-obesity");
        pill.textContent = label;
        catPillWrapper.appendChild(pill);

        // Tip depending on goal
        bmiTipEl.textContent = goalTip(cat, goal);
      });
    </script>
  </body>
</html>