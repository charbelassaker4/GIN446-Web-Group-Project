<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>DreamFIT — Body Fat % Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
  <script type="module" src="../../firebase/state_listener.js"></script>
</head>

<body>
<header class="site-header">
  <div class="logo">Dream<span>FIT</span></div>
  <nav class="main-nav">
  <a href="../index.html">Home</a>
    <a href="bmi.html">BMI</a>
    <a href="bodyfat.html" class="active">Body Fat %</a>
    <a href="workout.html">Workouts</a>
    <a href="nutrition.html">Nutrition</a>
    <a href="muscle-composition.html">Muscle Viewer</a>
    <a href="profile.html">Profile</a>
    <button id="logout-btn" class="pill-btn">Logout</button>
    <script type="module" src="../../firebase/signout.js"></script>
  </nav>
</header>

<main class="page-narrow">

  <!-- HERO SECTION (same as BMI style) -->
  <section class="bmi-hero">
    <div class="bmi-hero-title-row">
      <h1>Body Fat Percentage</h1>
      <span class="bmi-glow-pill">Accurate Navy Method</span>
    </div>
    <div class="bmi-hero-underline"></div>
    <p class="page-intro">
      Estimate your body fat using the U.S. Navy formula.
      This method is more precise than BMI, but still an estimate — 
      combine it with measurements, photos, and strength progress.
    </p>
  </section>

  <!-- CARD SECTION -->
  <section class="card-section bmi-card-animated">

    <!-- Reset positioned like BMI -->
    <button type="button" id="reset-btn" class="btn-reset-floating">Reset</button>

    <form id="bodyfat-form" class="form-grid">

      <!-- Row 1 -->
      <div class="field">
        <label>Gender</label>
        <select id="gender" required>
          <option value="">Select...</option>
          <option value="male">Male</option>
          <option value="female">Female</option>
        </select>
      </div>

      <div class="field">
        <label>Height (cm)</label>
        <input type="number" id="height" required min="100" max="250" />
      </div>

      <div class="field">
        <label>Waist (cm)</label>
        <input type="number" id="waist" required min="40" max="200" />
      </div>

      <!-- Row 2 -->
      <div class="field">
        <label>Neck (cm)</label>
        <input type="number" id="neck" required min="20" max="100" />
      </div>

      <!-- Hip (female only) same width as other inputs -->
      <div class="field female-only" style="display: none;">
        <label>Hip (cm)</label>
        <input type="number" id="hip" min="40" max="200" />
      </div>

      <button type="submit" class="btn primary full-width">
        Calculate Body Fat %
      </button>
    </form>

    <div id="result"></div>
  </section>

</main>

<footer class="site-footer">
  <p>DreamFIT Body Fat Calculator — for educational use only.</p>
</footer>

<!-- SCRIPT -->
<script>
  const form = document.getElementById("bodyfat-form");
  const result = document.getElementById("result");
  const genderSelect = document.getElementById("gender");
  const femaleFields = document.querySelector(".female-only");
  const resetBtn = document.getElementById("reset-btn");

  genderSelect.addEventListener("change", () => {
    if (genderSelect.value === "female") {
      femaleFields.style.display = "block";
      document.getElementById("hip").required = true;
    } else {
      femaleFields.style.display = "none";
      document.getElementById("hip").required = false;
    }
    result.innerHTML = "";
  });

  resetBtn.addEventListener("click", () => {
    form.reset();
    femaleFields.style.display = "none";
    result.innerHTML = "";
  });

  function getBodyFatCategory(gender, bf) {
    const v = bf;
    if (gender === "male") {
      if (v < 6) return { label: "Very low", className: "low-range" };
      if (v < 12) return { label: "Lower end", className: "healthy-range" };
      if (v < 20) return { label: "Typical", className: "healthy-range" };
      if (v < 28) return { label: "Above range", className: "high-range" };
      return { label: "High range", className: "very-high-range" };
    } else {
      if (v < 8) return { label: "Very low", className: "low-range" };
      if (v < 14) return { label: "Lower end", className: "healthy-range" };
      if (v < 22) return { label: "Typical", className: "healthy-range" };
      if (v < 30) return { label: "Above range", className: "high-range" };
      return { label: "High range", className: "very-high-range" };
    }
  }

  function getInsightText(gender) {
    return gender === "male"
      ? `Body fat changes with muscle mass, hydration, and genetics. Focus on training, sleep, and nutrition.`
      : `Body fat varies naturally for women. Train for strength, energy, and long-term well-being.`;
  }

  form.addEventListener("submit", (e) => {
    e.preventDefault();
    result.innerHTML = "";

    const gender = genderSelect.value;
    const height = parseFloat(document.getElementById("height").value);
    const waist = parseFloat(document.getElementById("waist").value);
    const neck = parseFloat(document.getElementById("neck").value);
    const hip = gender === "female"
      ? parseFloat(document.getElementById("hip").value)
      : null;

    let bodyFat = 0;

    if (gender === "male") {
      bodyFat =
        495 /
          (1.0324 -
            0.19077 * Math.log10(waist - neck) +
            0.15456 * Math.log10(height)) -
        450;
    } else {
      bodyFat =
        495 /
          (1.29579 -
            0.35004 * Math.log10(waist + hip - neck) +
            0.221 * Math.log10(height)) -
        450;
    }

    if (bodyFat < 0) bodyFat = 0;
    if (bodyFat > 100) bodyFat = 100;

    const cat = getBodyFatCategory(gender, bodyFat);
    const safeMax = 60;
    const meterWidth = (Math.min(bodyFat, safeMax) / safeMax) * 100;

    result.innerHTML = `
      <div class="result-card">
        <h3>Your estimated body fat</h3>

        <p class="result-main">
          <span class="result-number">${bodyFat.toFixed(1)}%</span>
          <span class="result-label ${cat.className}">${cat.label}</span>
        </p>

        <div class="bf-meter">
          <div class="bf-meter-fill" style="width:${meterWidth}%"></div>
        </div>
      </div>

      <div class="insight-box">
        <h4>Insight</h4>
        <p>${getInsightText(gender)}</p>
      </div>
    `;
  });
</script>

</body>
</html>